const fs = require('fs')
const glob = require('glob')
const camelize = require('camelize')
const mysql = require('mysql')

module.exports = (options) => {
	const files = glob.sync('*.db.js', { cwd: './server/node_modules/common/db/' })
	const connectionPool = mysql.createPool(options.mysql)

	return files.map(file => {
		return {
			key: camelize(file.replace(/\.db\.js$/, '')),
			module: require('common/db/' + file)(connectionPool)
		}
	}).reduce((map, file) => {
		map[file.key] = file.module
		return map
	}, {})
}
